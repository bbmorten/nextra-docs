#  20230928 Scapy, Docker Desktop, Apache

## Apache HTTP Server Benchmarking Tool

```shell
> Apache HTTP server benchmarking tool.
> More information: <https://httpd.apache.org/docs/current/programs/ab.html>.

- Execute 100 HTTP GET requests to a given URL:

`ab -n {{100}} {{url}}`

- Execute 100 HTTP GET requests, in concurrent batches of 10, to a URL:

`ab -n {{100}} -c {{10}} {{url}}`

- Execute 100 HTTP POST requests to a URL, using a JSON payload from a file:

`ab -n {{100}} -T {{application/json}} -p {{path/to/file.json}} {{url}}`

- Use HTTP [K]eep Alive, i.e. perform multiple requests within one HTTP session:

`ab -k {{url}}`

- Set the maximum number of seconds to spend for benchmarking:

`ab -t {{60}} {{url}}`
```

<https://www.btegitim.com>

```shell
> ab -n 100 https://www.btegitim.com:443/
This is ApacheBench, Version 2.3 <$Revision: 1903618 $>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking www.btegitim.com (be patient).....done


Server Software:        Microsoft-IIS/10.0
Server Hostname:        www.btegitim.com
Server Port:            443
SSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES256-GCM-SHA384,2048,256
Server Temp Key:        ECDH P-521 521 bits
TLS Server Name:        www.btegitim.com

Document Path:          /
Document Length:        150 bytes

Concurrency Level:      1
Time taken for tests:   34.564 seconds
Complete requests:      100
Failed requests:        0
Non-2xx responses:      100
Total transferred:      67800 bytes
HTML transferred:       15000 bytes
Requests per second:    2.89 [#/sec] (mean)
Time per request:       345.642 [ms] (mean)
Time per request:       345.642 [ms] (mean, across all concurrent requests)
Transfer rate:          1.92 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:      159  284 438.3    186    2398
Processing:    51   61  37.5     56     425
Waiting:       51   57   7.7     56     111
Total:        211  345 438.5    242    2450

Percentage of the requests served within a certain time (ms)
  50%    242
  66%    247
  75%    249
  80%    253
  90%    303
  95%    749
  98%   2449
  99%   2450
 100%   2450 (longest request)
```

##  Repos for Docker

### Docker Network Graph

<https://github.com/LeoVerto/docker-network-graph.git>

```shell
git clone https://github.com/LeoVerto/docker-network-graph.git
cd docker-network-graph
pipenv install
pipenv run python docker-net-graph.py -o output.svg
```

###  Docker for MAC containers - awesome

<https://github.com/chipmk/docker-mac-net-connect.git>

```shell
# Install via Homebrew
$ brew install chipmk/tap/docker-mac-net-connect

# Run the service and register it to launch at boot
$ sudo brew services start chipmk/tap/docker-mac-net-connect

# Run an nginx container
$ docker run --rm --name nginx -d nginx

# Get the internal IP for the container
$ docker inspect nginx --format '{{.NetworkSettings.IPAddress}}'
172.17.0.2

# Make an HTTP request directly to its IP
$ curl -I 172.17.0.2
HTTP/1.1 200 OK
Server: nginx/1.21.3
Date: Thu, 11 Nov 2021 21:00:37 GMT
Content-Type: text/html
Content-Length: 615
Last-Modified: Tue, 07 Sep 2021 15:21:03 GMT
Connection: keep-alive
ETag: "6137835f-267"
Accept-Ranges: bytes
```

## Docker Network Tools

<https://github.com/jonlabelle/docker-network-tools>

```shell
docker run --rm -it --platform linux/arm64 jonlabelle/network-tools

```

##  Docker Desktop VM Access

According to this GitHub issue comment by a Docker maintainer, the recommended way to access the VM is through a privileged docker container.

Allowing access to some VM but I'm not sure.

```shell
docker run -it --privileged --pid=host justincormack/nsenter1

```

This one is from the book

!!! Docker Desktop VM Access

    At the time of writing, Docker Desktop provides no command to log into the VM if you want to explore it from the inside. However, you can run a special container configured to use the VM’s namespaces to run a remote shell, which is virtually identical to using SSH to access a remote server. To run the container, execute the following command:

    ```shell
    docker run --net=host --ipc=host --uts=host --pid=host --privileged \
    --security-opt=seccomp=unconfined -it --rm -v /:/host alpine chroot /host
    ```

##  Scapy

### arping

```shell
>>> arping(net="192.168.70.0/24")
Begin emission:
Finished sending 256 packets.
*********.************.*************.*
Received 38 packets, got 35 answers, remaining 221 packets
  44:2b:03:c7:d0:d5 Cisco    192.168.70.1
  84:a9:3e:54:e5:b4 HewlettP 192.168.70.5
  b4:b5:2f:f4:76:f4 HewlettP 192.168.70.24
  50:87:89:9f:64:20 Cisco    192.168.70.102
  50:87:89:9f:64:20 Cisco    192.168.70.104
  50:87:89:9f:64:20 Cisco    192.168.70.105
  50:87:89:9f:64:20 Cisco    192.168.70.106
  50:87:89:9f:64:20 Cisco    192.168.70.108
  00:15:5d:3e:34:2c Microsof 192.168.70.107
  50:87:89:9f:64:20 Cisco    192.168.70.110
  50:87:89:9f:64:20 Cisco    192.168.70.113
  50:87:89:9f:64:20 Cisco    192.168.70.117
  50:87:89:9f:64:20 Cisco    192.168.70.118
  50:87:89:9f:64:20 Cisco    192.168.70.119
  50:87:89:9f:64:20 Cisco    192.168.70.123
  50:87:89:9f:64:20 Cisco    192.168.70.125
  50:87:89:9f:64:20 Cisco    192.168.70.126
  50:87:89:9f:64:20 Cisco    192.168.70.127
  50:87:89:9f:64:20 Cisco    192.168.70.131
  50:87:89:9f:64:20 Cisco    192.168.70.132
  00:15:5d:3e:35:ce Microsof 192.168.70.133
  50:87:89:9f:64:20 Cisco    192.168.70.135
  50:87:89:9f:64:20 Cisco    192.168.70.138
  50:87:89:9f:64:20 Cisco    192.168.70.176
  50:87:89:9f:64:20 Cisco    192.168.70.184
  50:87:89:9f:64:20 Cisco    192.168.70.189
  50:87:89:9f:64:20 Cisco    192.168.70.192
  50:87:89:9f:64:20 Cisco    192.168.70.193
  50:87:89:9f:64:20 Cisco    192.168.70.196
  50:87:89:9f:64:20 Cisco    192.168.70.197
  50:87:89:9f:64:20 Cisco    192.168.70.198
  4c:e1:76:ff:ab:f4 Cisco    192.168.70.204
  50:87:89:9f:64:20 Cisco    192.168.70.207
  00:15:5d:3e:35:d3 Microsof 192.168.70.209
  50:87:89:9f:64:20 Cisco    192.168.70.245
(<ARPing: TCP:0 UDP:0 ICMP:0 Other:35>, <Unanswered: TCP:0 UDP:0 ICMP:0 Other:221>)
```

### Multihop Capture Analysis

![Talk To Can](<Screenshot 2023-09-28 at 12.12.11.png>)
