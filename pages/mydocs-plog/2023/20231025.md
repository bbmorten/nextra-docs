# 20231025 Python, XMLHttpRequest, Pydantic, SQLAlchemy, FastAPI

## Python FastAPI

- Retirement.py ile gelen bulk insert POST requestleri karşılayacak kodu yazdık.
- Raporlama ve veri girişi scriptleri. XMLHttpRequest/AJAX
    - /Users/bulent/git-repos/oreilly-courses/javascript/mjfb-brad-traversy/09-asynchronous-javascript/04-z1,
    - /Users/bulent/git-repos/oreilly-courses/javascript/mjfb-brad-traversy/09-asynchronous-javascript/04-z2-retirement-summary
    - /Users/bulent/git-repos/oreilly-courses/javascript/mjfb-brad-traversy/09-asynchronous-javascript/04-z3

```python title="retirement.py"

@router.post(
    "/bulk",
    status_code=status.HTTP_201_CREATED,
    response_model=schemas.SimpleResponse,
)
def create_bulk_retirement_logs(
    retirement_log: schemas.BulkRetirementLog,
    db: Session = Depends(get_db),
    current_user: int = Depends(oauth2.get_current_user),
):
    # logs_to_insert = []

    print(retirement_log)

    try:
        for entry in retirement_log.entries:
            # Field verification can be added here if necessary
            print(entry)
            new_log = models.RetirementLogs(owner_id=current_user.id, **entry.dict())
            db.add(new_log)

        db.commit()
        #return schemas.BulkRetirementLog(entries=retirement_log.entries)

    
    except Exception as e:
        # Handle exceptions here, you might want to rollback or log the error
        db.rollback()
        return {"message": f"Error: {str(e)}"}

    return schemas.SimpleResponse(message="Records created")
```

Schemas.py dosyasında yer alan aşağıdaki class'ın karşılığını bulmam iki gün aldı. `retirement_log.entries` yazılması gerekirken `retirement_log["entries"]` ile çok fazla vakit kaybettik.

```python
class BulkRetirementLog(BaseModel):
    entries: List[RetirementLogBase]
```

##  PostgreSQL, SQLAlchemy, Pydantic Example

/Users/bulent/git-repos/samples/pydantic/sample-postgresql.py

## Modern JavaScript from the Beginning - Second Edition

***Chapter 10: Callback Hell*** buradan devam edeceğiz. 


