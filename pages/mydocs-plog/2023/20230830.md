# 20230830 - Python, Javascript continues

## Javascript

### dotenv

[dotenv Documentation](https://www.dotenv.org/docs/quickstart)

###  Environment Variables usage Angular

Olay .env file'ı nasıl eklerim projeye diye başladı ama olay başka yerlere gitti.

npx @angular/cli add @ngx-env/builder
npx @angular/cli generate environments

Sonrasında angular.json file oynadım. Çalışır haldeki şöyle.

Şundan da yararlandım.

<https://medium.com/bb-tutorials-and-thoughts/how-to-read-environment-specific-variables-in-angular-9f2cee0b2b4>

```json title='angular.json'
{
  "$schema": "./node_modules/@angular/cli/lib/config/schema.json",
  "version": 1,
  "newProjectRoot": "projects",
  "projects": {
    "json-viewer-app": {
      "projectType": "application",
      "schematics": {},
      "root": "",
      "sourceRoot": "src",
      "prefix": "app",
      "architect": {
        "build": {
          "builder": "@ngx-env/builder:browser",
          "options": {
            "outputPath": "dist/json-viewer-app",
            "index": "src/index.html",
            "main": "src/main.ts",
            "polyfills": [
              "zone.js"
            ],
            "tsConfig": "tsconfig.app.json",
            "assets": [
              "src/favicon.ico",
              "src/assets"
            ],
            "styles": [
              "src/styles.css"
            ],
            "scripts": []
          },
          "configurations": {
            "production": {
              "budgets": [
                {
                  "type": "initial",
                  "maximumWarning": "500kb",
                  "maximumError": "1mb"
                },
                {
                  "type": "anyComponentStyle",
                  "maximumWarning": "2kb",
                  "maximumError": "4kb"
                }
              ],
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/environment.prod.ts"
                }
              ],
              "outputHashing": "all"
            },
            "dev": {
              "buildOptimizer": false,
              "optimization": false,
              "vendorChunk": true,
              "extractLicenses": false,
              "sourceMap": true,
              "namedChunks": true,
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/environment.dev.ts"
                }
              ]
            },
            "test": {
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/environment.test.ts"
                }
              ]
            }
          },
          "defaultConfiguration": "production"
        },
        "serve": {
          "builder": "@ngx-env/builder:dev-server",
          "configurations": {
            "production": {
              "browserTarget": "json-viewer-app:build:production"
            },
            "dev": {
              "browserTarget": "json-viewer-app:build:dev"
            },
            "test": {
              "browserTarget": "json-viewer-app:build:test"
            }
          },
          "defaultConfiguration": "dev"
        },
        "extract-i18n": {
          "builder": "@ngx-env/builder:extract-i18n",
          "options": {
            "browserTarget": "json-viewer-app:build"
          }
        },
        "test": {
          "builder": "@ngx-env/builder:karma",
          "options": {
            "polyfills": [
              "zone.js",
              "zone.js/testing"
            ],
            "tsConfig": "tsconfig.spec.json",
            "assets": [
              "src/favicon.ico",
              "src/assets"
            ],
            "styles": [
              "src/styles.css"
            ],
            "scripts": []
          }
        }
      }
    }
  }
}

```

Servisi şu şekilde başlatıyorum. Port değiştirmek istersen. Ama environment değişkenden nasıl alacak henüz bulamadım.

```javascript
ng serve --configuration=dev --port=4200

```

Environment değişkeni böyle kullandım.

```javascript
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { environment } from 'src/environments/environment';


@Injectable({
  providedIn: 'root',
})
export class MyDataService {
  constructor(private http: HttpClient) {}

  getData(): Observable<any> {
    console.log(environment.srv_port);
    return this.http.get(`http://localhost:${environment.srv_port}/getData`);
  }
}
```

DeĞişik bir yaklaşım. Basit ama etkili.

<https://medium.com/@dhilt/how-to-change-angular-cli-development-server-port-via-env-9335d089e469>

```javascript title='run-env.js'
const dotenv = require('dotenv');
const child_process = require('child_process');

const config = dotenv.config()
const DEV_SERVER_PORT = process.env.DEV_SERVER_PORT || 4200;

const child = child_process.exec(`ng serve --port=${DEV_SERVER_PORT}`);
child.stderr.on('data', err => console.error(err));
child.stdout.on('data', data => console.log(data.toString()));
```

Uyguladım çalışıyor.

### Parsing a filename / path module

In Node.js, you can change the file extension of a string using the path library which comes with Node.js by default. The path.parse() method can parse the file name into root, dir, base, ext and name. You can then change the ext to .json and reassemble the file name.

Here's an example:

```javascript
const path = require('path');

let fileName = "xxx.m3u";
let parsed = path.parse(fileName);

// Change the extension
parsed.ext = ".json";
parsed.base = `${parsed.name}${parsed.ext}`;

// Assemble the new filename
let newFileName = path.format(parsed);
console.log(newFileName);  // Output will be "xxx.json"

```

### Creating Arrays with Array.from

```javascript
Array.from({ length: 5 }, (v, i) => i);

```

Certainly! The `Array.from()` function in JavaScript creates a new array instance from a given array-like or iterable object. The function takes two arguments:

1. The first argument is the array-like or iterable object to convert to an array.
2. The second argument is an optional map function to call on every element of the array.

In your code snippet, `Array.from({ length: 5 }, (v, i) => i);`, the first argument is an object with a property `length` set to `5`. When `Array.from()` sees this, it knows to create an array of length `5`.

The second argument is the mapping function `(v, i) => i`, where `v` is the value of the element and `i` is the index of the element.

1. `v` will be `undefined` for each element because the initial array is actually an array of `undefined` values (since it was created from an object with only a `length` property and no actual values).

2. `i` will be the index of each element in the array, starting from `0` and going up to `4` (since the length is `5`).

The mapping function simply returns `i`, which replaces `undefined` in the original array. So the output will be `[0, 1, 2, 3, 4]`.

To break it down:

- Initial array-like object: `{ length: 5 }` leads to an "array" of `undefined` values: `[undefined, undefined, undefined, undefined, undefined]`
- Map function: `(v, i) => i` changes each `undefined` to its index value
- Final array: `[0, 1, 2, 3, 4]`

```javascript
> str = "xxx.m3u"
'xxx.m3u'
> newStr = Array.from({length : str.length - 3}, (v,i) => v = str[i] )
[ 'x', 'x', 'x', '.' ]
```

## Python

### Consuming the first element of an array / next()

To skip the first element of the array (file lines, in this case), you can simply use next(lines) before entering the loop. This will consume the first line so it won't appear in subsequent iterations. Here's how you can modify your code to achieve this:

```python
import json

def convert_to_json(file_path):
    result = []
    with open(file_path, "r", encoding="utf-8") as file:
        lines = iter(file)
        next(lines, None)  # Skip the first line
        for line1, line2 in zip(lines, lines):
            line = line1.strip()
            if line.startswith("#EXTINF"):
                entry = parse_line(line, line2.strip())
                if entry:
                    try :
                        entry_reformat = {}
                        entry_reformat['stream_id'] = entry['id']
                        entry_reformat['stream_name'] = entry['name']
                        entry_reformat['stream_logo'] = entry['logo']
                        entry_reformat['stream_group_title'] = entry['group-title']
                        entry_reformat['stream_description'] =  entry['description']
                        entry_reformat['stream_url'] = entry['url']
                        result.append(entry_reformat)
                    except Exception as e:
                        print(e)
                        pass
    return json.dumps(result, indent=4, ensure_ascii=False)


```
